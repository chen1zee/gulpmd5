define("page/user/warranty",function(e){e("common"),e("jquery.form.min");{var t=e("page/user/refreshaddress"),s=e("DateUtil"),a=getUrlParam("tid");getUrlParam("tname")}$(function(){document.getElementById("saleDate").valueAsDate=new Date;var e=s.dateToStr("yyyy-MM-dd",new Date);$("#saleDate").attr("max",e);var r=function(e){baseJS.util.doRequest("",server+"/getlistgoodsstyle.smg",{tenantid:a,goodsid:e},function(e){if("success"!=e.status)return"fail"==e.status?void 0:void showMsg("服务器繁忙,请稍后重试");var e=e.data;$("select[name='styleid']").empty(),$(e).each(function(){$("select[name='styleid']").append("<option value='"+this.styleid+"'>"+this.stylename+"</option>")})})};$.post(server+"/getheadurl.smg",{tenantid:a},function(e){if("success"!=e.status)return"fail"==e.status?void 0:void showMsg("服务器繁忙,请稍后重试");for(var e=e.data,t=e.extimage,s=0;s<t.length;s++)"1"==t[s].imgid&&($("#warranty").html(t[s].tenantName),$(".grey_img").css("background-image","url("+t[s].imgPath+")")),"2"==t[s].imgid&&$("#user_info").html("<img src='"+t[s].imgPath+"' width='100%' HEIGHT='60px'/>");var a="<li><a href='{0}'><b><img src='{1}' /></b><span>{2}</span></a></li>",r="";for(var s in e.extlink){var i=e.extlink[s];r+=baseJS.util.formatString(a,i.linkurl,i.imageurl,i.caption)}$(".mainmenu").html(r)}),$.post(server+"/getlistgoods.smg",{tenantid:a},function(e){if("success"!=e.status)return"fail"==e.status?void 0:void showMsg("服务器繁忙,请稍后重试");var e=e.data,t=e[0].goodsid;r(t),$("select[name='goodsid']").empty(),$(e).each(function(){$("select[name='goodsid']").append("<option value='"+this.goodsid+"'>"+this.goodsname+"</option>")})}),$.post(server+"/common/getaddress.smg",{type:2,parentid:1},function(e){if("success"!=e.status)return"fail"==e.status?void showMsg(e.message):void showMsg("服务器繁忙,请稍后重试");var e=e.data,s=e[0].taobaoid;t.refreshCityAndDistrict(server+"/common/getaddress.smg",s),$("select[name='provinceid']").empty(),$(e).each(function(){$("select[name='provinceid']").append("<option value='"+this.taobaoid+"'>"+this.name+"</option>")})}),$("select[name='provinceid']").change(function(){var e=parseInt($(this).val());t.refreshCityAndDistrict(server+"/common/getaddress.smg",e)}),$("select[name='cityid']").change(function(){var e=parseInt($(this).val());t.refreshDistrict(server+"/common/getaddress.smg",e)}),$("select[name='goodsid']").change(function(){var e=$(this).val();$("select[name='styleid']").empty(),r(e)})}),window.saveWarrantyCard=function(){{var e=$("#CustomerName").val().trim(),t=$("#phone").val().trim(),s=($("#mail").val().trim(),$("#qq").val().trim(),$("#goodsid").val().trim()),r=$("#styleid").val().trim(),i=$("#barcode").val().trim();$("#price").val().trim(),$("#saleShop").val().trim(),$("#address").val().trim(),$("#saleDate").val().trim(),$("#saleInvoice").val().trim(),$("#remark").val().trim()}if(""==e)return showMsg("请输入个人姓名！"),$("#CustomerName").focus(),!1;if(""==t)return showMsg("请输入联系电话！"),$("#phone").focus(),!1;if(""==s)return showMsg("请选择产品！"),$("#goodsid").focus(),!1;if(""==r)return showMsg("请选择商品型号！"),$("#styleid").focus(),!1;if(""==i)return showMsg("请输入唯一码！"),$("#barcode").focus(),!1;if(!checkFileSize($("#saleInvoice"),2048))return void showMsg("上传文件不能大于2M");var o=server+"/addwarrantyfile.smg";$("form").attr("enctype","multipart/form-data");var n=$("#saleInvoice")[0].files[0];null==n&&($("form").attr("enctype","application/x-www-form-urlencoded"),o=server+"/addwarranty.smg");$("#addrForm").ajaxSubmit({type:"post",url:o,data:{tenantid:a},success:function(e){"success"==e.status?(showMsg("提交成功，感谢您登记！"),$("#addrForm").clearForm()):showMsg(e.message)},error:function(e,t,s){showMsg("提交时出错！"+t+s)}})}});